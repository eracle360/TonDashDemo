<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ton Dash</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      .iconColor {
        color: rgb(149, 149, 149);
      }
      h2 {
        font-size: 25px;
      }
      /* .navbar {
        background-color: rgba(0, 0, 0, 0.7) !important; 
        backdrop-filter: blur(10px);
        z-index: 2;
        position: fixed;
        width: 100%;
      }
      .navbar-toggler {
        border: none;
      }
      .navbar-toggler:focus {
        outline: none;
      }
      .navbar-collapse.collapse.show {
        background-color: rgba(
          0,
          0,
          0,
          0.9
        );
      }
      .navbar-brand {
        font-size: 1.5rem;
        font-weight: bold;
        display: flex;
        align-items: center;
        color: white !important; 
      }
      .navbar-brand img {
        margin-right: 10px;
      }
      .nav-link,
      .navbar-brand {
        font-size: 1.1rem;
        color: white !important;
      } */
      .video-container {
        position: relative;
        overflow: hidden;
        height: 100vh;
      }
      .video-container video {
        position: absolute;
        top: 50%;
        left: 50%;
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        z-index: 1;
        transform: translate(-50%, -50%);
      }
      .video-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* Optional: To darken the video */
        z-index: 1;
      }
      .header-content {
        position: relative;
        z-index: 3;
        color: white;
        text-align: center;
        padding-top: 200px;
      }
      .container {
        margin-top: 20px;
      }
      .footer {
        text-align: center;
        padding: 10px;
        background-color: #f8f9fa;
      }
      .search-bar {
        margin-top: 20px;
        max-width: 600px;
        position: relative;
      }
      .content h2 {
        margin-top: 40px;
        text-align: center;
      }
      .app-grid-wrapper {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        padding: 10px 0;
        gap: 20px;
      }
      .app-grid-wrapper .card {
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.3s ease;
        flex: 0 0 auto;
        width: 80%;
        margin-right: 10px;
      }
      .card-body .icons i {
        margin: 0 5px;
        font-size: 20px;
      }
      @media (min-width: 768px) {
        .app-grid-wrapper {
          flex-wrap: wrap;
          justify-content: space-between;
        }
        .app-grid-wrapper .card {
          width: 48%;
          margin-right: 0;
        }
      }
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2;
        display: none;
      }
      .search-results {
        position: absolute;
        width: 100%;
        background: white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: none;
        z-index: 3;
        max-height: 300px;
        overflow-y: auto;
      }
      .search-results .result-item {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        color: black; /* Ensuring text color is black for visibility */
      }
    </style>
  </head>
  <body>
    <header>
      <!-- <nav
        class="navbar navbar-expand-lg navbar-dark"
        style="z-index: 10; padding: 0.5rem 2rem"
      >
        <a class="navbar-brand" href="/">
          <img
            src="/images/logo.png"
            alt="Ton Dash Logo"
            style="height: 40px"
          />
          Ton Dash
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="#news">News</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/jettons">Jettons</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/promoteapp">Promote App</a>
            </li>
            <li class="nav-item">
              <div id="telegram-login-widget"></div>
              <script
                async
                src="https://telegram.org/js/telegram-widget.js?"
                data-telegram-login="DashTonbot"
                data-size="medium"
                data-onauth="onTelegramAuth(user)"
                data-request-access="write"
              ></script>
            </li>
          </ul>
        </div>
      </nav> -->

      <%- include('partials/topBar') %>

      <div class="video-container" style="height: 530px">
        <video autoplay loop muted>
          <source src="/videos/galaxy.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
        <div class="video-overlay"></div>
        <div class="header-content" style="margin: 0 10px">
          <h1>Welcome to Ton Dash</h1>
          <p>Your one-stop platform for app submissions and listings.</p>
          <form
            class="search-bar mt-4"
            style="margin: auto"
            onsubmit="return false;"
          >
            <input
              type="text"
              class="form-control"
              placeholder="Search for apps..."
              name="q"
              id="search-input"
              onfocus="showOverlay()"
              onblur="hideOverlay()"
              style="height: 55px; border-radius: 30px; padding: 0 20px"
            />
            <div class="search-results" id="search-results"></div>
          </form>
        </div>
      </div>
    </header>

    <div class="overlay" id="overlay"></div>

    <div class="container" style="margin-top: 50px" id="promote">
      <h2>Promoted Apps</h2>
      <div class="app-grid-wrapper">
        <% promotedApps.forEach(function(app) { %>
        <div class="card shadow">
          <div class="row no-gutters" style="padding: 0 10px">
            <div class="col-3" style="padding: 10px">
              <a href="/app/<%= app._id %>">
                <img
                  src="<%= app.icon %>"
                  class="card-img"
                  alt="<%= app.appName %>"
                  style="width: 100%; height: auto"
                />
              </a>
            </div>
            <div class="col-9">
              <div class="card-body">
                <a href="/app/<%= app._id %>">
                  <h5 class="card-title">
                    <%= app.appName %>
                    <i class="fas fa-check-circle" style="color: #1da1f2"></i>
                  </h5>
                </a>
                <p class="card-text" style="font-size: 14px">
                  <%= app.description.length > 20 ? app.description.substring(0,
                  20) + "..." : app.description %>
                  <!-- <%= app.description %> -->
                </p>
                <div class="icons" style="margin-top: 10px">
                  <i class="fas fa-globe iconColor"></i>
                  <i class="fab fa-apple iconColor"></i>
                  <i class="fab fa-android iconColor"></i>
                  <i class="fab fa-telegram-plane iconColor"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
    </div>

    <div class="container" id="news" style="margin: 50px auto">
      <!-- News Section -->
      <h2>News</h2>
      <style>
        .card {
          height: 100%;
          border-radius: 10px !important;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
        }
        .card-body {
          display: flex;
          flex-direction: column;
        }
        .card-title,
        .card-text {
          margin-bottom: 0.5rem;
        }
        .card-text {
          flex-grow: 1;
        }
        .read-more-btn {
          align-self: flex-end;
          margin-top: 10px;
          border-radius: 20px;
          font-size: 15px;
          padding: 5px 20px;
        }
        .img-radius {
          border-radius: 10px 10px 0 0;
        }
      </style>

      <div class="container mt-4">
        <div class="row row-cols-1 row-cols-md-3 g-4">
          <div class="col mb-4">
            <div class="card h-100">
              <img
                src="/images/tonton.jpg"
                class="img-radius card-img-top"
                alt="..."
              />
              <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">
                  This is a longer card with supporting text below as a natural
                  lead-in to additional content. This content is a little bit
                  longer.
                </p>
                <a href="#" class="btn btn-primary read-more-btn">Read More</a>
              </div>
            </div>
          </div>
          <div class="col mb-4">
            <div class="card h-100">
              <img
                src="/images/tony.jpg"
                class="img-radius card-img-top"
                alt="..."
              />
              <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">
                  This is a longer card with supporting text below as a natural
                  lead-in to additional content. This content is a little bit
                  longer.
                </p>
                <a href="#" class="btn btn-primary read-more-btn">Read More</a>
              </div>
            </div>
          </div>
          <div class="col mb-4">
            <div class="card h-100">
              <img
                src="/images/tot.jpg"
                class="img-radius card-img-top"
                alt="..."
              />
              <div class="card-body">
                <h5 class="card-title">Card title</h5>
                <p class="card-text">
                  This is a longer card with supporting text below as a natural
                  lead-in to additional content.
                </p>
                <a href="#" class="btn btn-primary read-more-btn">Read More</a>
              </div>
            </div>
          </div>
          <!-- Repeat similar structure for more cards -->
        </div>
      </div>
    </div>

    <div class="container">
      <h2>Apps</h2>
      <div class="app-grid-wrapper">
        <% approvedApps.forEach(function(app) { %>
        <div class="card shadow">
          <div class="row no-gutters">
            <div class="col-3" style="padding: 10px">
              <a href="/app/<%= app._id %>">
                <img
                  src="<%= app.icon %>"
                  class="card-img"
                  alt="<%= app.appName %>"
                  style="width: 100%; height: auto"
                />
              </a>
            </div>
            <div class="col-9">
              <div class="card-body">
                <a href="/app/<%= app._id %>">
                  <h5 class="card-title">
                    <%= app.appName %>
                    <i class="fas fa-check-circle" style="color: #1da1f2"></i>
                  </h5>
                </a>
                <p class="card-text">
                  <!-- <%= app.description.substring(0, 15) %>... -->
                  <%= app.description.length > 20 ? app.description.substring(0,
                  20) + "..." : app.description %>
                </p>
                <div class="icons" style="margin-top: 10px">
                  <i class="fas fa-globe iconColor"></i>
                  <i class="fab fa-apple iconColor"></i>
                  <i class="fab fa-android iconColor"></i>
                  <i class="fab fa-telegram-plane iconColor"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Arial", sans-serif;
        background-color: #f8f9fa;
        color: #333;
        /* display: flex; */
        /* justify-content: center; */
        /* align-items: center; */
        min-height: 100vh;
      }

      .table-container {
        width: 100%;
        /* max-width: 930px; */
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .title {
        text-align: left;
        font-size: 24px;
        margin-bottom: 20px;
        color: #333;
      }

      .jettons-table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
        font-size: 14px;
        /* margin-top: 30px; */
      }

      .jettons-table thead th {
        background-color: #f1f3f5;
        color: #495057;
        padding: 12px 15px;
        border-bottom: 2px solid #e9ecef;
      }

      .jettons-table tbody tr {
        border-bottom: 1px solid #e9ecef;
        transition: background-color 0.3s ease;
      }

      .jettons-table tbody tr:hover {
        background-color: #f8f9fa;
      }

      .jettons-table th,
      .jettons-table td {
        padding: 15px;
        text-align: left;
      }

      .jettons-table tbody td img {
        width: 30px;
        height: 30px;
        vertical-align: middle;
        margin-right: 10px;
      }

      .jettons-table tbody td {
        font-size: 16px;
        color: #495057;
      }

      .jettons-table tbody td:nth-child(2),
      .jettons-table tbody td:nth-child(3),
      .jettons-table tbody td:nth-child(4) {
        /* text-align: right; */
      }

      .jettons-table tbody td:nth-child(4) {
        color: #28a745; /* Default positive change */
      }

      .jettons-table tbody td.red {
        color: #dc3545; /* Negative change */
      }

      @media (max-width: 600px) {
        .table-container {
          padding: 15px;
        }

        .jettons-table {
          font-size: 12px;
        }

        .jettons-table thead th,
        .jettons-table tbody td {
          padding: 10px;
        }
      }
    </style>
    <div class="container">
      <div
        class="table-container"
        style="margin-top: 60px; margin-bottom: 40px"
      >
        <h1 class="title">Jettons</h1>
        <table class="jettons-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Market Cap</th>
              <th>Price</th>
              <th>1h %</th>
            </tr>
          </thead>
          <tbody>
            <% jettons.slice(0, 5).forEach(function(jetton, index) { %>
            <!-- Limit to 5 jettons -->
            <% const changeClass = jetton.quote.USD.percent_change_1h < 0 ?
            'red' : ''; %>
            <tr>
              <td><%= index + 1 %></td>
              <td>
                <img
                  src="https://s2.coinmarketcap.com/static/img/coins/64x64/<%= jetton.id %>.png"
                  alt="<%= jetton.name %> logo"
                />
                <%= jetton.name %><br />
                <span style="color: grey"
                  >$<%= (jetton.quote.USD.market_cap / 1000000).toFixed(0)
                  %>M</span
                >
              </td>
              <td>$<%= jetton.quote.USD.price.toFixed(4) %></td>
              <td class="<%= changeClass %>">
                <%= jetton.quote.USD.percent_change_1h.toFixed(2) %> %
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>

    <footer class="footer mt-auto py-3 bg-light">
      <div class="container">
        <span class="text-muted"
          >&copy; 2024 Ton Dash. All rights reserved.</span
        >
      </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      // function onTelegramAuth(user) {
      //   alert("Logged in as " + user.username);
      // }

      function showOverlay() {
        document.getElementById("overlay").style.display = "block";
      }

      function hideOverlay() {
        document.getElementById("overlay").style.display = "none";
        setTimeout(() => {
          document.getElementById("search-results").style.display = "none";
        }, 200);
      }

      function debounce(func, delay) {
        let debounceTimeout;
        return function (...args) {
          clearTimeout(debounceTimeout);
          debounceTimeout = setTimeout(() => func.apply(this, args), delay);
        };
      }

      function showSearchResults(query) {
        const resultsContainer = document.getElementById("search-results");
        if (query.trim() === "") {
          resultsContainer.innerHTML = "";
          resultsContainer.style.display = "none";
          return;
        }

        $.ajax({
          url: "/search",
          type: "GET",
          data: { q: query },
          success: function (data) {
            resultsContainer.innerHTML = "";

            if (data.length > 0) {
              data.forEach((app) => {
                const resultItem = document.createElement("div");
                resultItem.classList.add("result-item");
                resultItem.innerHTML = `
                            <a href="/app/${app._id}">
                                <img src="${app.icon}" alt="${app.appName}" style="width: 30px; height: 30px; margin-right: 10px;">
                                <strong>${app.appName}</strong>
                            </a>`;
                resultsContainer.appendChild(resultItem);
              });

              resultsContainer.style.display = "block";
            } else {
              resultsContainer.style.display = "none";
            }
          },
        });
      }

      const searchInput = document.getElementById("search-input");
      searchInput.addEventListener(
        "input",
        debounce(function (event) {
          showSearchResults(event.target.value);
        }, 300)
      );
      searchInput.addEventListener("focus", showOverlay);
      searchInput.addEventListener("blur", hideOverlay);
    </script>
  </body>
</html>
